# Coding Conventions

### 2016-03-02 Wed

- coding conventions （コーディング規約）と呼ばれるものがある。
- C 言語に限らず、プログラミングにおいて、ある一つの働きを実現するプログラムでも、書き方は様々にある。保守性などのために、こう書くとよい、という規範がいくらか存在する。
- また、プログラムは一般に、書いた者だけが読むのではない。コミュニケーションをする際に、パターンを定めておくことで、計算の手間が減る。そのため、プログラムの開発においては、チームにおいてコーディング規約を定め、メンバーがそれを守ることが有効である。
- そのように、チームにおいて定められたコーディング規約は、チーム内においては問題なく共有できるかもしれない。しかしだとしても、外部のチーム間でコミュニケーションを行う場合には、しばしば互いに異なるコーディング規約が、コミュニケーションを阻害する。プログラミングにおいて、決定的な標準と言えるコーディング規約が存在しないことが多い。その理由は、世の中の進歩が未熟であるというよりも、domain によって最適が異なることに由来している。
- また、単に、自分自身のために小さなプログラムを書く時ですら、ある時はよく整ったプログラムを書いたつもりであっても、あとでスタイルが変わってから見ると、スタイルが趣味に合わず、不完全さを感じることがあるかもしれない。そのように、コーディング規約、コーディングスタイルは、かなり低いプラットフォームである。そこを整えておくことが、上部構造を気持ちよく建設するために大切であると思われる。

#### -

- 最近私は、Haskell 言語に触った。触りはじめた時は、全て Haskell で完結させられたらいいな、という思いを持った。しかし、簡単なことをするにも、C 言語より面倒な場合が多いようであり、結局はパフォーマンスのために結果的な手続きを考えなければならず、なるべく Haskell で書こうという考えは失った。
- また私は、HTML 言語と JavaScript 言語に触れた。Windows OS と Unix OS だけを考えるならば、Java 言語で実装した GUI アプリケーションが、どちらの環境でも動いた。しかし、スマートフォンは、Android にしろ iOS にしろ Java SE をサポートしなかったので、HTML+JavaScript が今後の世界だと私は感じた。HTML5 が整備され、TypedArray などが実装されて、パフォーマンスも改善されつづけていた。しかし、ローカルなファイルシステムとの関係が便利ではないし、JavaScript の言語仕様は、スタイルの標準がなく、理解しがたかった。
- 次に私は、ノートパソコンに Ubuntu Linux をインストールして使うことをした。Ubuntu は、魅力的だった。Unix の本質的な美しさに加えて、フォントやウィンドウデザインに満足できた。
- Windows を使っていた時、Microsoft 社が提供する馬鹿げた改変に妥協して、使える範囲でパソコンを使うことが当然だった。例えば Windows 8 では、Metro UI を使わない場合でも、少しの操作ミスで Metro UI に遷移し、それでいて Metro UI をオフにするオプションはなかった。またいつだって、フォントやウィンドウデザインに満足できなかった。
- Apple は、低俗で反社会的な商売を展開しているようだったので、活用の候補から遠かった。
- Unix の古いテキストに掲載されたサンプルコードを入力してみて Ubuntu で動いた時、私の価値観は大きく動かされた。これが、私の生まれた時代において最も安定した依存環境なのだとやっと知った。システムコールも、基本的なコマンド群も、bash shell も、よく整理されていて、とても枯れていた。
- 私には余裕がなく、何もかもを勉強することはとてもできないから、なるべく変わらないものと関わっていきたい、という思いが強い。
- 私は、Java 言語を好んでいた。統合開発環境 Eclipse と Java SE で、なるべくなんでも済ませたいと思っていた。しかし、Oracle が Sun を買収して、ドキュメントの多くがリンク切れになり消滅するなど、Java の足場には不安定さが感じられた。
- Linux で、C 言語を学んでみると、プロセッサに直接触れることは気分良く感じられた。非常に優れた人々は、さほど Java を愛していない、と感じられた。gcc コマンドと gdb コマンドで大抵のことはやり遂げられるべきだと思われた。
- C 言語よりも下へ行くと、CPU アーキテクチャ固有の議論に分岐していく。幾重ものレイヤーに依存することを嫌うとしても、現代において最善に不変なのは、（Unix 上の） C 言語であると考えられる。
- 私はそもそも、コンピュータを勉強する強い動機を持っていない。しかし、サイバー攻撃の踏み台にはなりたくないから、あまりにも無知ではいたくない。例えば、こうして少しメモを取るにも、export できない広告つきのブログサービスに書く人もいるだろうが、それをしないぐらいには世界を知っていたい。しかし、どういうプログラムを作りたいという欲求はなく、力もない。
- license というのは、現代の本質だと思う。copyleft とは、意義深いことだと思う。意味的な生存圏であると考えられる。明日のために残しておかねばならないものだと考えられる。
- ある機能、システムを、どのような tool らの組み合わせによって実現するかは、考えものである。大きな会社の有能な人々ならば、最新の有料のツールで製造して納品してしまうことが文句なしに合理的だろう。オープンソースソフトウェアの品質は一般に低いと思われる。
- しかし権利をいくらかでも持っていたいなら、契約書が大切である。手のひらを返されても生きていたいならば、依存しないことが大切である。
- Unix OS と C 言語は、深く関係している。深く関係しているというか、同じところから始まっている。Unix が登場してから半世紀が経ち、ハードウェアの機能の規模は何桁も飛躍したが、ソフトウェアの基本的な設計は安定している。基本的なコマンドは変わらず使われているし、データの流れをディレクトリ構造上のファイルへの読み書きとして表したりすることも変わっていない。
- なお、インタプリタ言語では、Python 言語が一強となっているようである。
- Linux kernel coding style という文書がある。Linus Torvalds によるものであるらしい。また、C++ is a horrible language. ... という Linus Torvalds による文章もある。私は先日初めてこれらをざっと見て、印象的であった。
- Linux Kernel Coding Style では、まず、tab は 8 文字だと言っている。20 時間コードを眺めるような場合によいという。そのような機会自体は私にはないが、興味深い。
- 自然言語の英文の段落の冒頭でインデントが行われる場合は、5 文字分などが用いられるらしい。コンピュータではそもそも、tab は 8 文字であったらしい。後に 4 文字が流行して今はそれが支配的であるようだ。Windows と Mac では基本的に 4 文字であるらしい。しかし less コマンドなど、Unix のデフォルトでは 8 文字が使われつづけている。タブが 8 文字であると、要素が小さい場合には、tab-separated values (TSV) ファイルがそのまま整理されて見える。
- また、広く言われ、Linux Kernel Coding Style でも言われているのは、1 行を 80 文字以下にすることである。1 行が 80 文字で 1 tab が 8 文字だと、不便な場合があるように思われる。しかし、Linux Kernel Coding Style では、4 つ以上のインデントはやめて設計を見直すように言っている。また、1 つの関数は原則として 49 行以上であるべきではないとされる。また、ローカル変数は 11 個以上あるべきではないとされる。1 つの関数は 1 のことのみ行うべきだとされる。主旨として、細かく関数に分けることを勧めているように読める。
- プログラミング一般について世間で最も好まれているインデントは、空白文字 4 個であると思われる。tab の使用は、テキストエディタ間の不統一のために批判される。
- 逆に言えば、仮にいかなる環境でもタブが 8 文字であったならば、タブを避けるべき理由はない。
- 個人的には、空白文字の連続をバックスペースキーを連打して削除するような時間が嫌いである。環境が支援してくれて問題がない場合が多いが、それは環境に依存しているということになる。タブは、環境の支援なしに、入力も削除もやりやすい。
- Linux Kernel Coding Style、また、C 言語では、簡単な識別子を推奨している。Java では、長く説明的な識別子を好む傾向がある。私自身は、長く説明的な識別子が保守性に貢献すると思う。しかし、80 文字行 8 文字タブだと、長い識別子は調和しにくいだろう。Haskell では、短い識別子が好まれる。実際、長い識別子は見通しを悪くする。
- Linux kernel というのは、最も保守性を重視している世界の一つなのだろう。Linus Torvalds という人は、実績から自明かもしれないが、優れた人なのだろう。
- 私は、8 文字インデント、それもタブ文字によるそれに、興味を持っている。Linux Kernel Coding Style は、無視すべきものではなく、むしろコーディング規約の王なのではないかと思っている。
- Linus Torvalds による C++ への批判は興味深い。
- 私は従来、どちらかと言えば、C 言語は C++ 言語に取って代わられたものだと思っていた。また、C++ と Java あるいは C# では、後者 2 つのほうが設計については勝り、単にパフォーマンスの意味で前者が勝っているという程度に思っていた。しかし、C++ は、読みにくいコードを書く者が生じるという短所があるようである。
- C++ を使わずに、C 言語だけで、どこまでできるのだろうか？
- 言語だけで言ったならばきっと、C# が最も先進的なのだろう。しかし、Windows に依存するのは大きすぎる短所である。依存の少なさで言えば、Linux + C が最も好ましいと思われる。
- Dennis Ritchie は 1993 年に The Development of the C Language で C 言語を portable assembly language だと言った。それは、実際中間コードとして利用されていることを指してのことだが、広くしばしば、C 言語は、portable assembly language だとか portable assembler だとか呼ばれる。C 言語は、CPU アーキテクチャに依存しない中では最も低く、かつ長い人気がある。C 言語でプログラムを書けば、コンパイラの強力な最適化もあって、最も速く動くと期待できる。そして、C 言語の仕様はそれ以上に大きくない。
- 利便性の理想を求めれば、どこまでもリッチな統合開発環境と言語が望ましい。しかし、それを追い求めることは、依存性の上をさまようことになり、面倒くさい。流行してから多く年月が過ぎたものだけ使うのが、楽で合理的だと思われる。
- Linux Kernel Coding Style に欠陥や、ドメインの限界があるなら、それはどのようなものなのだろうか？　とりあえずは、しばらく 8 文字タブを使ってみたいと思っている。
