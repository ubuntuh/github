# Assembly Language

### 2016-03-07 Mon

#### Assembly Language

- アセンブリ言語 (assembly language) とは、プログラミング言語の一種である。
- コンピュータは、0 と 1 で表せる 2 進数の列である機械語の命令によって動作するが、その機械語は、人間にとっては直接扱い辛い。一方で、ソフトウェアを作成するプログラミングにおいては例えば、広く、C 言語が用いられている。機械語に比べ、C 言語は、ずっと人間に扱いやすい。そのように、低いレイヤー（階層）に機械語があり、高いレイヤーに C 言語があると考えることができる。その時、アセンブリ言語とは、その中間にあるものだと考えていい。
- より具体的に説明しよう。自動計算機を実現する方法には、機械的に物理的に実現する方法や、アナログ回路によって電気的に実現する方法や、情報を離散的に扱うデジタル回路によって電子的に実現する方法がある。時代が下り、技術が進歩するに従って、電子的な処理の活躍する範囲が広がった。今や、様々な機器それぞれの、制御を担当する部品において、中心的に計算を行っているのはプロセッサである。プロセッサへの命令、すなわち動作手順は機械語で表されるが、様々な企業の販売する様々なプロセッサがあり、同じ機械語であってもそれへの理解の仕方が異なる。

#### Instruction Set Architecture, ISA

- そのプロセッサの種類それぞれで異なる言葉を、命令セットアーキテクチャ (instruction set architecture, ISA) と言う。personal computer 市場で人気のある Microsoft Windows OS は、米国の Intel 社が作るプロセッサと共に使われることが多かったが、そこで使われる Intel のプロセッサで主に用いられた ISA は、x86 である。x86 において、16 進数で 89 e5 と表される機械語は、アセンブリ言語では movl %esp, %ebp と表される。これは、プロセッサの ESP という記憶領域にある値を、EBP という記憶領域にコピーして格納せよ、という意味である。
- アセンブリ言語で書かれたプログラムをアセンブリと言う。アセンブリを機械語に変換する（アセンブルする）プログラムをアセンブラと呼び、機械語からアセンブリに変換する（ディスアセンブルする）プログラムをディスアセンブラと呼ぶ。
- C 言語でプログラミングし、ソフトウェアを作成する場合、まず C 言語で int main(void) { return 0; } などとプログラムを書き、それをコンパイラでアセンブリに変換し、アセンブリをアセンブラで変換して機械語の製品を作る。C 言語からアセンブリへの変換と、アセンブリから機械語への変換は、しばしば自動的に行われるため、その全体をコンパイルと呼ぶことも多い。
- C 言語は、portable assembly language と呼ばれる。つまり ISA に依存していないということである。逆に言うと、アセンブリは ISA に依存している。機械語とアセンブリ言語を low-level programming language と言い、それより上全て、プログラミング言語と普通言われるもののほとんど全ては、high-level programming language と言う。

#### Virtualization

- ソフトウェアの実装においては、汎用な部分をライブラリとして分離し、operating system (OS) と呼ぶ。残った固有な部分それぞれを application software と呼ぶ。application software から見て、operating system を supervisor （監督者）とも言うが、OS の更に外側を覆うモジュールを設けた場合、それを hypervisor と言う。例えば Windows パソコンの中で VirtualBox などの hypervisor プログラムを使うと、その中に他の OS をインストールして使うことができる。この、hypervisor によって実現される機能を OS 仮想化と言う。下にあって親になる環境を host と呼び、上にあって子になる環境を guest と呼ぶ。guest OS に対しては、host と異なる ISA を提供し、異なる CPU アーキテクチャをエミュレートすることも可能である。よって例えば、x86 アーキテクチャ上で ARM アーキテクチャのアセンブリの機械語を動作させることもできる。
- また、Java などでは、仮想マシン (virtual machine, VM) が用いられる。Java 言語で書かれたプログラムは普通、ネイティブな、host 環境のプロセッサの機械語にコンパイルされるのではなく、VM のための bytecode と呼ばれる中間コードへとコンパイルされる。このような、主に仮想環境に向けた機械語は、特定の文脈では普通にアセンブリとして言及されるが、一般的な文脈ではアセンブリというイメージに含まれないことが多い。ただし、Java bytecode をネイティブに実行する Java processor と呼ばれるものもあって、high-level language computer architecture の代表とされているから、Java bytecode がアセンブリではないと言うことはできない。

#### The Assemblers

- アセンブラには、様々なものがある。
- Linux では C 言語のプログラムをコンパイルするために普通 gcc というプログラムが使われる。gcc では、C プログラムは一旦、アセンブリに変換され、さらに機械語に変換されるが、その際に使われているアセンブラは、as というプログラムであり、正式名称を GNU Assembler と言う。

#### AT&T syntax or Intel syntax

- アセンブリの基本的な記述の仕方には 2 種類あって、AT&T syntax と Intel syntax と言う。
- Windows におけるソフトウェア開発においては、Intel syntax が支配的であるようである。Unix では歴史的に、AT&T syntax であるようである。分かりやすさで言うと、ほとんど差はないらしいが、どちらかと言えば Intel syntax に人気があるようである。
- Linux において標準的ないくつかのコマンドでは、オプションであえて指定しないかぎり AT&T syntax が用いられる。

#### Directory Structure

- アセンブリを勉強したい。
- アセンブリを勉強するにあたって、asm というディレクトリを作ったが、この下はどのように分けるべきだろうか？
- gas、nasm など、アセンブラによって分ける方法と、x86、x64 など、ISA によって分ける方法が考えられると思われる。
- アセンブラの異なるアセンブリが混雑すると扱いが悪くなるだろうから、アセンブラで分けることが合理的であると思われる。
- 結果的に ISA による分類は重複する仕組みになるだろう。
