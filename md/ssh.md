# SSH

### 2016-02-10 Wed

* GitHub では、SSH を使う。SSH とは何だろうか？
* ある種の財に希少性があることがあり、ある 2 者が協力的な立場のみならず競争的な立場に置かれることがある。その時、敵性の計算機が事実を認知することを妨げることが利益になる場合がある。例えば、動物が捕食者に対して自分の存在を隠そうとすることがある。そのように、秘密はしばしば財産である。
* 商売とは、安く買って高く売ることだと考えることができる。あるいは、市場での価値が高い製品をなるべく安い費用で作ることだと考えることができる。そこに企業の価値があると考えることができ、その情報を独占が維持できないならばその企業は存続することができないと考えることができる。であれば、秘密情報がパンを生む泉であると考えることができる。企業経営とは、秘密情報を建設しまた防衛することであると考えられる。
* 情報を秘密にする技術を、cryptography （暗号理論）という。情報を送信する者、受信する者、盗聴しようとする攻撃者は、しばしば Alice、Bob、Eve と呼ばれる。情報は、攻撃者が入手しても理解できない形で通信される。それを暗号文と言い、もとの情報を平文（ひらぶん）と言う。暗号文にすることを暗号化 (encryption)、暗号文を平文に変換することを復号 (decryption) と言う。
* 暗号の主要な方法として、共通鍵暗号方式と公開鍵暗号方式とがある。
* 共通鍵暗号方式では、Alice と Bob で同じ鍵を持っておく。例えば同じ乱数列を持っておく。そうしておいて、通信したい情報を、その乱数に従って変換する。こうすると、Eve はこれを盗聴することはできない。この、通信したい情報と同じ情報量の乱数を用いた方法は、基本的でありながら完全である。しかし、より便利にするために、他にも様々な方法がある。共通の鍵を使う方法を纏めて共通鍵暗号方式と呼ぶ。
* 公開鍵暗号方式では、Alice は、秘密鍵 (secret key, sk) と公開鍵 (public key, pk) を持っておき、pk を公開する。Alice に情報を送りたい Bob は、Alice の pk で情報に鍵をかけ、Alice に送信する。Alice は Alice の sk でこれを開ける。また Alice の sk でしかこれを開くことはできないため、Eve は Alice の pk を持っていても情報を取り出せない。このような鍵らの関係は、数学的に実現される。この方法の大きな利点は、鍵の安全な配送の実現にある。詳細には様々な方法があるが、このように秘密鍵と公開鍵を使う方法を纏めて公開鍵暗号方式と呼び、共通鍵暗号方式と区別する。
* SSH とは、安全に通信するためのプロトコルであり、Secure Shell とも言う。SSH プロトコルの実装として現在、広く使われているのは、BSD ライセンスである OpenSSH である。
* SSH では、client と server という概念が用いられる。
* SSH client は、sk と pk を作成し、pk を server に知らしめる。知らしめるというのは具体的には、pk を server に送信し、server の内部に保持する。
* しかし、client に sk を平文で保存しておくことは危険であるから、暗号化して保存しておく。このための鍵を passphrase と言う。

## ssh-keygen

* ssh-keygen コマンドによって、sk と pk を作ることができる。
* ssh-keygen コマンドは、内部で擬似乱数を生成して sk と pk を作る。
* ssh-keygen -t rsa -b 4096 -C "your_email@example.com" などとする。-t オプションは暗号方式を、-b は鍵の大きさを、-C オプションではコメントを指定している。
* -t オプションでの選択肢は、dsa、ecdsa、ed25519、rsa、rsa1 である。ここで sa1 は SSH プロトコルのバージョン 1 のものであり、他はバージョン 2 のものである。
* 作られた鍵は普通、~/.ssh/ に置かれる。暗号方式を rsa にした場合、passphrase で暗号化された sk が ~/.ssh/id\_rsa ファイルに記録され、pk は ~/.ssh/id\_rsa.pub ファイルに記録される。
* サーバ側では、~/.ssh/authorized\_keys に、クライアントらの id\_rsa.pub などの内容が保持される。
* デフォルトのコメントもつけたくない場合には、ssh-keygen -C "" としてもいい。
* 特定の公開鍵の指紋を見るには、ssh-keygen -lf id\_rsa.pub などとする。
* md5 形式で見たい場合には、ssh-keygen -lf id\_rsa.pub -E md5 などとする。
* ssh git@github.com として接続のテストができる。

## ssh-agent

* ssh を使うたびにユーザが passphrase を入力するのは煩わしい。そのために、ssh-agent という機能がある。
* ssh-agent は自動的に起動され、そのプロセスのメモリ空間に秘密情報を保護している。
* ssh-agent に登録されている秘密鍵は、ssh-add -l で表示できる。
* ssh-keygen で作成した鍵がここで表示されるのは、単に ~/.ssh/ にあるものを反映しているにすぎない。不要になって削除したいものがあるなら、~/.ssh/id\_rsa などを削除すれば、こちらにも表示されなくなる。
* ssh-agent は、環境変数 SSH\_AUTH\_SOCK の設定に使われる。SSH\_AGENT\_PID も設定されることもある。

## known_hosts

* ~/.ssh/known_hosts というファイルには、ホスト認証のための情報が記録される。
* 例えば GitHub の場合、What are GitHub's SSH key fingerprints? というページがあって、GitHub の指紋が公開されている。
* test
