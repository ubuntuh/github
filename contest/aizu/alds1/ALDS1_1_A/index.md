### 2015-12-27 Sun

- insertion sort というものを、設問の擬似コードに従って C++ で実装した。
- Haskell でも、一応動作するものを実装してみたが、C++ で実装するよりもずっと読みにくく、機能的にもデメリットはありえてもメリットは考えられないであろうものになった。
- 他に 2 人、Haskell で submit されたコードを公開していたので、勉強させていただいた。私には難しく、とてもうまく Haskell を使いこなしているように見えたが、しかし insertion sort について Haskell で実装することを有意義とまでは感じられなかった。
- insertion sort の前半部分が整列済みになっている、という論理を、Haskell が表すことは感じられた。
- しかし、計算効率を考えたアルゴリズムであろうから、破壊的代入を捨象（無視？）した記述は、不満足な感じもする。破壊的代入をしっかり書きたい気もするが、Haskell でその方法はあるらしいが知らないのと、だったら C++ でいいということがある。
- ネストしたループについて、カウンタ全てを引数とする再帰関数で実装したと思うのだが、性能においても可読性においても悪いだろう。
- Haskell で書くのには悩んだが、書けたので、練習にはなったろう。
- おそらく、多数のカウンタを引数として再帰でごりごり回すのは、Haskell らしくない。読みやすくないし、C++ でやる方が効率的で簡潔に書けるだろう。
- しかし、C++ などを想定した擬似コードを、多数のカウンタを用いて何やら少し強引な感じで Haskell で実装してしまう方法はわかった。
- emacs で Haskell 書いたが、支援機能がパースエラー起こすらしく、そうなるとインデント機能が消滅して、空白を連打する必要があり、使いにくかった。emacs は使いにくい。
- Haskell に適さない？コードを書く場合にも、自分で多少納得がいくだけ整理されたコードを書けるようになっていきたい。
- テストデータが小さいからやっと動作している気がしてならない。
- ...
- insertion sort というのは、未整列の要素を 1 つ取っては、整列済みのリストを完成させていくところに本質？というか抽象的な基本があるらしい。なのでそこを素直に書いたコードを書いてみようと思って、書いた。しかし、設問の仕様上、整列の過程を出力しなければならない。
- 過程を出力するには、Debug.Trace.trace のようなものが便利だが、副作用がないような型の関数で副作用を生じることは、乱用するのは行儀が悪いらしい。確かに、自分で混乱するだろう。
- sort する再帰関数に、log という引数を追加して、そこにログを格納していき、あとで出力することにした。submit してみたら、log という関数は Prelude にあるらしく、色つけされてしまった。より適切な名前とは？
- 変数 log に再帰的に経過を記録し、その際、リストの末尾に追加していったが、リストの末尾に追加するのはよくないのかもしれない。car を n 回、cons を n + 1 回とかかかるだろうか。
- 命令型の擬似コードを強引に移したものよりずっと簡潔になったが、要素をコロコロコロッと入れ替えていく処理は消えたので、かなり関係のない実装になってしまった気がする。
- 純粋な insertionSort そのものの実装と、過程を出力するための実装が、地味に分離された実装に落ち着いた。そのバランスが選択できる問題だったようだ。他に、insertionSort の中にまで副作用を持ち込む方法もあるし、副作用は持ち込まなくても、純粋な insertionSort は消して、過程を出力するための実装を根幹にまで混ぜてしまう方法がある。そのどちらかが、より短いコードになるが、論理は複雑に混ざってしまうことになるだろう。
- Haskell は、細かく関数に分けて型を定めるので、プログラムの全体像が理解できていなくても、コンパイルを通った時には正常な出力が出る正しいプログラムになっているのが不思議である。
- プログラムがわかりにくくなってきたので、documentation を（コメントとして）つけたいと思ったが、うまくいかなかった。Haddock だとか Cabal というものを用いるらしい。haddock helloworld.hs -h -o helloworld-html などとしてみたが、隠蔽されたメンバのドキュメンテーションは表示されなかったようだ。haddock に沿ったドキュメンテーションの書き方については、ウェブの hoogle で基本的な関数を調べても、そのソースコードが閲覧できるので、そこに書かれたものが参考になるだろう。
- ドキュメンテーションの内容は、例えば Prelude.reverse の場合、「reverse xs returns the elements of xs in reverse order. xs must be finite.」となっていて、このように、関数の場合、返り値に言及するものが多いようだ。日本語だと、「〜は〜を返す。」といった表現になるだろう。
