# ALDS1_1_D: Maximum Profit

### 2015-12-24 Thu

- 簡単な問題らしいのだが、いきなりわからない。
- せっかくだから、なるべく答えを見ずに、考える練習をしてみたい。
- n = 6 のとき、t = 0 から 5 で、価格 R\_0 から R\_5 までが存在する。
- 全ての t で買い、買ったそれぞれを全ての可能な t で売ることが考えられる。
- ある時刻 t\_a に買った通貨を売却できる時刻は、t\_a + 1 から t\_{n - 1} までである。
- n は 2 以上である。t\_{n - 1} に買った通貨を売却できる時刻は存在しない。
- ある時刻 t\_a に買った通貨が最も高く売却できるのは、価格 max(R\_a + 1 から R\_{n - 1}) でである。
- 時刻 t に買った通貨で得られる最大の利益を maxProfit (t) と表せる。すると、複数の時刻 T を考えた時の最大の利益 maxProfit (T) は、T のそれぞれの t について maxProfit (t) の最大値である。
- 計算量を無視すると、この方法で答えを得られるように思われる。
- ある時刻 t\_a に通貨を買ったと考え、次の時刻 t\_a + 1 には通貨の価格が下がった場合、通貨を買い直したと考え、もはや元の時刻 t\_a に通貨を購入した場合については考えなくてよい。
- ある時刻 t\_a に通貨を売ったと考え、次の時刻 t\_a + 1 には通貨の価格が上がった場合、通貨を売り直したと考え、もはや元の時刻 t\_a に通貨を売却した場合については考えなくてよい。
- 以前よりも安く購入できた場合、その時刻は最大値の候補になる。以前の候補は枯れる。
- 枯れた候補は、時刻と利益の組である。
- 生きた候補は、常に 1 つだけ存在し、その時刻は、過去における通貨の価格の最小値である。
- 枯れた候補が複数生じた場合、利益が最大のもの以外は捨てられる。なぜなら、利益が最大の枯れた候補か、現在の生きた候補に負けるからである。
- 時間を後ろから見るとどうか？
- 売却を先に考えてみる。
- ある時刻 t\_a に売却する通貨を購入できる時刻は、0 から a - 1 までである。
- ある時刻 t\_a に売却する通貨が最大の利益をもたらすのは、価格 min(R\_0 から R\_{a - 1}) との差においてである。
- ...
- 時間を後ろから見るのはやめる。
- 入力が終わった時、1 つの生きた候補と、0 または 1 個の枯れた候補がある。生きた候補は枯れて、時刻と利益の組になる。枯れた候補が 2 つになった場合には、片方が淘汰される。
- これでうまくいくなら（時間）計算量は、1 回の走査だから O(n) だと言えるだろう。空間計算量は O(1) だろう。
- もしこれでうまくいくとしたならば、より良い方法はあるだろうか？　より良い方法がないということは、どのように言えるのだろうか？　もしこれでうまくいくとしたならば、これでうまくいくということをどのようにもっと整理して言えるだろうか？
- とりあえず、プログラムして、自動判定に弾かれてから考えることも考えられる。
- 最初の価格でとりあえず買う。
- もし、次が最後の価格でなく、かつ、価格が下がったならば、買いなおす。最初の価格は最大利益の候補から外れる。最後の価格で購入することは、何にせよない。
- そうではなく、もし価格が等しいか増加したならば、それを最大利益として確保する。
- さらに次の価格が、さらに増加したならば、それを最大利益として確保しなおす。前の売却候補は、最大利益の売却候補から外れる。
- 新たな価格が、既存の売却候補よりも高くなく、既存の購入候補より安くもない場合、捨てる。次の価格を考える。
- 新たな価格が、既存の購入候補よりも安い場合、それを生きた候補とし、既存の購入・売却候補を、枯れた候補とする。
- 枯れた候補が複数生じた場合、利益が最大のものの 1 つ以外を捨てる。
- 例えば入力が 100, 99, 1 だった場合、価格 100 で購入して 99 で売るのが最大利益 -1 であり、もし 99 で購入すると、1 で売るしかなく、利益は -98 になってしまう。
- それを防止するためには、価格が下がったからといって、以前の購入候補を捨てられない。
- 価格が下がりつづける場合を特別視できるだろうか？　改めてもう 1 度走査してもいいだろうか？
- 価格が下がりつづける場合、もっとも緩やかなところを探すことになる。隣接する 2 点で最も差の小さいところが最大利益になる。
- 価格が下がりつづけない場合の最大利益は 0 以上である。価格が下がりつづける場合の最大利益は -1 以下である。
